{% extends 'base.html' %}

{% block title %}Driver Dashboard - ROREM{% endblock %}

{% block content %}
<div class="dashboard-header">
    <div class="row align-items-center">
        <div class="col-md-8">
            <h1 class="h3 mb-2">Welcome back, {{ user.username }}! üëã</h1>
            <p class="text-muted">Ready to hit the road? Here's your driving overview.</p>
        </div>
        <div class="col-md-4 text-end">
            <div class="btn-group">
                <a href="{% url 'maps:live_map' %}" class="btn btn-primary">
                    <i class="fas fa-plus me-2"></i>Request Help
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Stats Overview -->
<div class="row">
    <div class="col-xl-3 col-md-6">
        <div class="card stat-card">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-8">
                        <h6 class="text-muted mb-0">Total Requests</h6>
                        <h3 class="mt-2 fw-bold">{{ total_requests|default:"0" }}</h3>
                    </div>
                    <div class="col-4 text-end">
                        <i class="fas fa-list-alt fa-2x text-primary"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-md-6">
        <div class="card stat-card success">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-8">
                        <h6 class="text-muted mb-0">Completed</h6>
                        <h3 class="mt-2 fw-bold">{{ completed_requests|default:"0" }}</h3>
                    </div>
                    <div class="col-4 text-end">
                        <i class="fas fa-check-circle fa-2x text-success"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-md-6">
        <div class="card stat-card warning">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-8">
                        <h6 class="text-muted mb-0">Active Requests</h6>
                        <h3 class="mt-2 fw-bold">{{ active_requests_count|default:"0" }}</h3>
                    </div>
                    <div class="col-4 text-end">
                        <i class="fas fa-clock fa-2x text-warning"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-3 col-md-6">
        <div class="card stat-card">
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-8">
                        <h6 class="text-muted mb-0">Avg. Response</h6>
                        <h3 class="mt-2 fw-bold">N/A</h3>
                    </div>
                    <div class="col-4 text-end">
                        <i class="fas fa-bolt fa-2x text-info"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <!-- Quick Actions -->
    <div class="col-lg-4">
        <div class="card">
            <div class="card-header bg-white border-0">
                <h5 class="card-title mb-0">Quick Actions</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-6">
                        <a href="{% url 'maps:live_map' %}" class="text-decoration-none">
                            <div class="quick-action">
                                <i class="fas fa-plus-circle"></i>
                                <h6>Request Help</h6>
                                <small class="text-muted">Get immediate assistance</small>
                            </div>
                        </a>
                    </div>
                    <div class="col-6">
                        <a href="{% url 'maps:live_map' %}" class="text-decoration-none">
                            <div class="quick-action">
                                <i class="fas fa-map-marked-alt"></i>
                                <h6 class="mb-1" style="color: #1e3a8a;">Live Map</h6>
                                <small class="text-muted">Find nearby help</small>
                            </div>
                        </a>
                    </div>
                    <div class="col-6">
                        <a href="{% url 'request_history' %}" class="text-decoration-none">
                            <div class="quick-action">
                                <i class="fas fa-history"></i>
                                <h6>History</h6>
                                <small class="text-muted">Past requests</small>
                            </div>
                        </a>
                    </div>
                    <div class="col-6">
                        <a href="{% url 'users:profile_settings' %}" class="text-decoration-none">
                            <div class="quick-action">
                                <i class="fas fa-user-cog"></i>
                                <h6>Settings</h6>
                                <small class="text-muted">Manage profile</small>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vehicle Info -->
        <div class="card mt-4">
            <div class="card-header bg-white border-0">
                <h5 class="card-title mb-0">Vehicle Information</h5>
            </div>
            <div class="card-body">
                <div class="d-flex align-items-center mb-3">
                    <i class="fas fa-car fa-2x text-primary me-3"></i>
                    <div>
                        <h6 class="mb-0">{{ user.driver.vehicle_type }}</h6>
                        <small class="text-muted">Vehicle Type</small>
                    </div>
                </div>
                <div class="d-flex align-items-center mb-3">
                    <i class="fas fa-tag fa-2x text-success me-3"></i>
                    <div>
                        <h6 class="mb-0">{{ user.driver.license_plate }}</h6>
                        <small class="text-muted">License Plate</small>
                    </div>
                </div>
                <div class="d-flex align-items-center">
                    <i class="fas fa-map-pin fa-2x text-warning me-3"></i>
                    <div>
                        <h6 class="mb-0">{{ user.driver.current_latitude|default:"N/A" }}, {{ user.driver.current_longitude|default:"N/A" }}</h6>
                        <small class="text-muted">Current Location</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Active Requests & Recent Activity -->
    <div class="col-lg-8">
        <!-- Active Request -->
        {% if active_request %}
        <div class="card">
            <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">Active Request</h5>
                <span class="status-badge status-{{ active_request.status }}">{{ active_request.get_status_display }}</span>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-info-circle fa-2x me-3"></i>
                        <div>
                            <h6 class="mb-1">Help is on the way!</h6>
                            <p class="mb-0">Your provider is on their way.</p>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <h6>Service Details</h6>
                        <p><strong>Type:</strong> {{ active_request.get_service_type_display }}</p>
                        <p><strong>Provider:</strong> {{ active_request.accepted_provider.company_name|default:"N/A" }}</p>
                        <p><strong>Estimated Cost:</strong> ‚Çµ{{ active_request.estimated_price|default:"N/A" }}</p>
                    </div>
                    <div class="col-md-6">
                        <h6>Provider Info</h6>
                        <p><strong>Driver:</strong> {{ active_request.accepted_provider.user.username|default:"N/A" }}</p>
                        <p><strong>Phone:</strong> {{ active_request.accepted_provider.phone|default:"N/A" }}</p>
                        <p><strong>Rating:</strong> ‚≠ê{{ active_request.accepted_provider.rating|default:"N/A" }}</p>
                    </div>
                </div>
                
                <div class="mt-3">
                    <button class="btn btn-outline-primary me-2">
                        <i class="fas fa-phone me-1"></i>Call Provider
                    </button>
                    <button class="btn btn-outline-warning me-2">
                        <i class="fas fa-map me-1"></i>Track Location
                    </button>
                    <a href="{% url 'bookings:cancel_request' active_request.id %}" class="btn btn-outline-danger">
                        <i class="fas fa-times me-1"></i>Cancel Request
                    </a>
                </div>
            </div>
        </div>
        {% else %}
        <div class="card">
            <div class="card-body text-center">
                <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                <h5 class="card-title">No Active Requests</h5>
                <p class="text-muted">You're all set! No pending or active service requests.</p>
            </div>
        </div>
        {% endif %}

        <!-- Recent Requests -->
        <div class="card mt-4">
            <div class="card-header bg-white border-0">
                <h5 class="card-title mb-0">Recent Requests</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Service</th>
                                <th>Provider</th>
                                <th>Amount</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for request in recent_requests %}
                            <tr>
                                <td>{{ request.created_at|date:"M d, h:i A" }}</td>
                                <td>{{ request.get_service_type_display }}</td>
                                <td>{{ request.accepted_provider.company_name|default:"N/A" }}</td>
                                <td>‚Çµ{{ request.estimated_price|default:"0.00" }}</td>
                                <td><span class="status-badge status-{{ request.status }}">{{ request.get_status_display }}</span></td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5" class="text-center">No recent requests found.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}